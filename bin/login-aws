#!/bin/bash

if [[ $(uname -n) == dev-dsk* ]]; then
	# Step 1. Generate Midway cookie and Kerberos ticket
	echo "Generating Midway cookie..."
	mwinit -s -o

	echo "Renewing Kerberos ticket (if possible)..."
	kinit -R
	kinitnew() { kinit -f -r 7d; }
	if [[ ! $(klist | grep "ANT") ]] || [[ $(klist -l | grep "Expired") ]]; then
		kinitnew
	fi
	echo "Done!"
else
	# Step 1. Midway
	echo "Generating AEA Midway cookie..."
	mwinit --aea

	# Step 2. SSH into Cloud Desktop
	ssh devdesk
fi
